{"version":3,"sources":["GameManager.js"],"names":["ROWS","DIRECTION","cc","Enum","RIGHT","LEFT","UP","DOWN","MIN_LENGTH","Class","extends","Component","properties","scoreLabel","Label","bestScoreLabel","blockPrefab","Prefab","bgBox","Node","cellPrefab","loseLayOut","winLayOut","hoverScorePrefab","newGameBtn","Button","_gap","default","serializable","_blockSize","_data","_arrBlock","_posisions","_score","_canMove","_startPoint","_endPoint","_firstX","_firstY","_endX","_endY","_vector","_isCLick","_tempScore","_canWin","onLoad","active","start","width","eventHandler","getScoreStorge","blockInit","init","arrInit","x","y","blockArr","Array","i","j","updateScore","row","col","getComponent","setNumber","addBlock","push","height","block","instantiate","parent","setPosition","v2","getEmptyLocations","locations","length","location","Math","floor","random","position","number","checkGameOver","gameOver","num","string","hoverScore","node","tween","to","call","destroy","systemEvent","on","SystemEvent","EventType","KEY_UP","onKeyDown","sys","isMobile","event","getLocation","reflectTouch","IPAD","DESKTOP_BROWSER","mouseEvent","startVec","endVec","pointsVec","sub","vecLength","mag","abs","touchEvent","keyCode","macro","KEY","right","blockMoveRight","left","blockMoveLeft","up","blockMoveUp","down","blockMoveDown","direction","afterMove","hasMoved","checkScore","moveBlock","callback","action","moveTo","finish","callFunc","runAction","sequence","combineBlock","b1","b2","_canCombine","scale1","scaleTo","scale2","mid","gameWin","activeCombine","n","move","toMove","count","opacity","interactable","onRestartClick","children","onContinueClick","scoreStorge","localStorage","getItem","JSON","parse","newScore","parseInt","setItem","stringify"],"mappings":"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","file":"GameManager.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["//Dong\r\nconst ROWS = 4;\r\nconst DIRECTION = cc.Enum({\r\n    RIGHT: -1,\r\n    LEFT: -1,\r\n    UP: -1,\r\n    DOWN: -1\r\n});\r\nconst MIN_LENGTH = 10;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        scoreLabel: cc.Label,\r\n        bestScoreLabel: cc.Label,\r\n        blockPrefab: cc.Prefab,\r\n        bgBox: cc.Node,\r\n        cellPrefab: cc.Prefab,\r\n        loseLayOut: cc.Node,\r\n        winLayOut: cc.Node,\r\n        hoverScorePrefab: cc.Prefab,\r\n        newGameBtn : cc.Button,\r\n\r\n        _gap: {\r\n            default: 10,\r\n            serializable: false,\r\n        },\r\n        _blockSize: null,\r\n        _data: [],\r\n        _arrBlock: [],\r\n        _posisions: [],\r\n        _score: null,\r\n        _canMove: true,\r\n        _startPoint: null,\r\n        _endPoint: null,\r\n        _firstX: null,\r\n        _firstY: null,\r\n        _endX: null,\r\n        _endY: null,\r\n        _vector: null,\r\n        _isCLick: true,\r\n        _tempScore: 0,\r\n        _canWin: true,\r\n    },\r\n\r\n    onLoad() {\r\n        this._canWin = true;\r\n        this._canMove = true;\r\n        this.loseLayOut.active = false;\r\n        this._isCLick = true;\r\n        this._tempScore = 0;\r\n    },\r\n\r\n    start() {\r\n        this._blockSize = (this.bgBox.width - this._gap * 5) / 4;\r\n        this.eventHandler();\r\n        this.getScoreStorge();\r\n        this.blockInit();\r\n        this.init();\r\n    },\r\n\r\n    arrInit(x, y) {\r\n        let blockArr = new Array();\r\n        for (let i = 0; i < x; i++) {\r\n            blockArr[i] = new Array();\r\n            for (let j = 0; j < y; j++) {\r\n                blockArr[i][j] = 0;\r\n            }\r\n        }\r\n        return blockArr;\r\n    },\r\n\r\n    init() {\r\n        this.updateScore(0);\r\n        this._data = this.arrInit(ROWS, ROWS);\r\n\r\n        for (let row = 0; row < ROWS; row++) {\r\n            for (let col = 0; col < ROWS; col++) {\r\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(0);\r\n                this._data[row][col] = 0;\r\n            }\r\n        };\r\n        this.addBlock();\r\n        this.addBlock();\r\n\r\n    },\r\n\r\n    blockInit() {\r\n        this._arrBlock = this.arrInit(ROWS, ROWS);\r\n        for (let i = 0; i < ROWS; i++) {\r\n            this._posisions.push([0, 0, 0, 0]);\r\n            for (let j = 0; j < ROWS; j++) {\r\n                let x = -(this.bgBox.width / 2) + (this._gap * (j + 1) + this._blockSize / 2 * (2 * j + 1));\r\n                let y = (this.bgBox.height / 2) - (this._gap * (i + 1) + this._blockSize / 2 * (2 * i + 1));\r\n                let block = cc.instantiate(this.blockPrefab);\r\n                block.parent = this.bgBox;\r\n                block.width = this._blockSize;\r\n                block.height = this._blockSize;\r\n                block.setPosition(cc.v2(x, y));\r\n                this._posisions[i][j] = (cc.v2(x, y));\r\n                block.getComponent(\"BlockController\").setNumber(0);\r\n                this._arrBlock[i][j] = block;\r\n            }\r\n        }\r\n    },\r\n\r\n    getEmptyLocations() {\r\n        let locations = [];\r\n        for (let row = 0; row < ROWS; row++) {\r\n            for (let col = 0; col < ROWS; col++) {\r\n                if (this._data[row][col] === 0) {\r\n                    locations.push({\r\n                        x: row,\r\n                        y: col,\r\n                    })\r\n                }\r\n            }\r\n        }\r\n        return locations;\r\n    },\r\n\r\n    addBlock() {\r\n        let locations = this.getEmptyLocations();\r\n        if (locations.length === 0) return false;\r\n\r\n        let location = locations[Math.floor(Math.random() * locations.length)];\r\n        let x = location.x;\r\n        let y = location.y;\r\n        let position = this._posisions[x][y];\r\n        let block = cc.instantiate(this.blockPrefab);\r\n        block.width = this._blockSize;\r\n        block.height = this._blockSize;\r\n        block.parent = this.bgBox;\r\n        block.setPosition(position);\r\n\r\n        let number = Math.random() <= 0.95 ? 2 : 4;\r\n        block.getComponent(\"BlockController\").setNumber(number);\r\n        this._arrBlock[x][y] = block;\r\n        this._data[x][y] = number;\r\n\r\n        if (this.checkGameOver()) {\r\n            this.gameOver()\r\n        }\r\n\r\n        return true;\r\n    },\r\n\r\n    updateScore(num) {\r\n        this._score = num;\r\n        this.scoreLabel.string = num;\r\n    },\r\n\r\n    hoverScore(num) {\r\n        if (num !== 0) {\r\n            let hoverScore = cc.instantiate(this.hoverScorePrefab);\r\n            hoverScore.parent = this.scoreLabel.node;\r\n            hoverScore.getComponent(cc.Label).string = \"+ \" + num;\r\n            cc.tween(hoverScore)\r\n                .to(1, { position: cc.v2(50, 50) })\r\n                .call(() => {\r\n                    hoverScore.destroy()\r\n                })\r\n                .start()\r\n        }\r\n    },\r\n\r\n    eventHandler() {\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyDown, this);\r\n\r\n        if (cc.sys.isMobile) {\r\n            this.bgBox.on(\"touchstart\", (event) => {\r\n                this._startPoint = event.getLocation();\r\n            })\r\n            this.bgBox.on(\"touchend\", (event) => {\r\n                this._endPoint = event.getLocation();\r\n                this.reflectTouch();\r\n            })\r\n            this.bgBox.on(\"touchcancel\", (event) => {\r\n                this._endPoint = event.getLocation();\r\n                this.reflectTouch();\r\n            })\r\n        }\r\n        if (cc.sys.IPAD || cc.sys.DESKTOP_BROWSER) {\r\n            this.bgBox.on(\"mousedown\", (event) => {\r\n                this._isCLick = false;\r\n                this._startPoint = event.getLocation();\r\n                this._firstX = this._startPoint.x;\r\n                this._firstY = this._startPoint.y;\r\n            })\r\n            this.bgBox.on(\"mouseup\", (event) => {\r\n                this._isCLick = true;\r\n                this._endPoint = event.getLocation();\r\n                this._endX = this._startPoint.x - this._endPoint.x;\r\n                this._endY = this._startPoint.y - this._endPoint.y;\r\n                this._vector = cc.v2(this._endX, this._endY);\r\n                this.mouseEvent();\r\n            })\r\n        }\r\n    },\r\n\r\n    reflectTouch() {\r\n        let startVec = this._startPoint;\r\n        let endVec = this._endPoint;\r\n        let pointsVec = endVec.sub(startVec);\r\n        let vecLength = pointsVec.mag();\r\n        if (vecLength > MIN_LENGTH) {\r\n            if (Math.abs(pointsVec.x) > Math.abs(pointsVec.y)) {\r\n                if (pointsVec.x > 0) this.touchEvent(DIRECTION.RIGHT);\r\n                else this.touchEvent(DIRECTION.LEFT);\r\n            } else {\r\n                if (pointsVec.y > 0) this.touchEvent(DIRECTION.UP);\r\n                else this.touchEvent(DIRECTION.DOWN);\r\n            }\r\n        }\r\n    },\r\n\r\n    onKeyDown(event) {\r\n        if (this._isCLick) {\r\n            if (this._canMove && !this.winLayOut.active) {\r\n                switch (event.keyCode) {\r\n                    case cc.macro.KEY.right:\r\n                        this._canMove = false\r\n                        this.blockMoveRight();\r\n                        break;\r\n                    case cc.macro.KEY.left:\r\n                        this._canMove = false\r\n                        this.blockMoveLeft();\r\n                        break;\r\n                    case cc.macro.KEY.up:\r\n                        this._canMove = false\r\n                        this.blockMoveUp();\r\n                        break;\r\n                    case cc.macro.KEY.down:\r\n                        this._canMove = false\r\n                        this.blockMoveDown();\r\n                        break;\r\n                };\r\n            }\r\n        };\r\n\r\n    },\r\n\r\n    touchEvent(direction) {\r\n        if (this._canMove && !this.winLayOut.active) {\r\n            switch (direction) {\r\n                case DIRECTION.RIGHT: {\r\n                    this._canMove = false\r\n                    this.blockMoveRight();\r\n                    break;\r\n                }\r\n                case DIRECTION.LEFT: {\r\n                    this._canMove = false\r\n                    this.blockMoveLeft();\r\n                    break;\r\n                }\r\n                case DIRECTION.UP: {\r\n                    this._canMove = false\r\n                    this.blockMoveUp();\r\n                    break;\r\n                }\r\n                case DIRECTION.DOWN: {\r\n                    this._canMove = false\r\n                    this.blockMoveDown();\r\n\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    mouseEvent() {\r\n        if (this._vector.mag() > MIN_LENGTH) {\r\n            if (this._canMove && !this.winLayOut.active) {\r\n                if (this._vector.x < 0 && this._vector.y < 50 && this._vector.y > -50) {\r\n                    this._canMove = false\r\n                    this.blockMoveRight();\r\n                } else if (this._vector.x > 0 && this._vector.y < 50 && this._vector.y > -50) {\r\n                    this._canMove = false\r\n                    this.blockMoveLeft();\r\n                }\r\n                if (this._vector.y < 0 && this._vector.x < 50 && this._vector.x > -50) {\r\n                    this._canMove = false\r\n                    this.blockMoveUp();\r\n                } else if (this._vector.y > 0 && this._vector.x < 50 && this._vector.x > -50) {\r\n                    this._canMove = false\r\n                    this.blockMoveDown();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    afterMove(hasMoved) {\r\n        this._canMove = true\r\n        if (hasMoved) {\r\n            this.addBlock();\r\n            this.checkScore();\r\n        }\r\n\r\n        this.hoverScore(this._tempScore);\r\n        this._tempScore = 0;\r\n    },\r\n\r\n    moveBlock(block, position, callback) {\r\n        let action = cc.moveTo(.05, position);\r\n        let finish = cc.callFunc(() => {\r\n            callback && callback();\r\n        })\r\n        block.runAction(cc.sequence(action, finish,));\r\n    },\r\n\r\n    combineBlock(b1, b2, num, callback) {\r\n        b1.destroy();\r\n        b2.getComponent(\"BlockController\")._canCombine = false\r\n        let scale1 = cc.scaleTo(0.1, 1.1);\r\n        let scale2 = cc.scaleTo(0.1, 1);\r\n        let mid = cc.callFunc(() => {\r\n            b2.getComponent(\"BlockController\").setNumber(num);\r\n        });\r\n        let finish = cc.callFunc(() => {\r\n            callback && callback();\r\n        })\r\n        b2.runAction(cc.sequence(scale1, mid, scale2, finish));\r\n        this.updateScore(this._score + num);\r\n        this._tempScore += num;\r\n        if (num === 2048 && this._canWin) {\r\n            this._canWin = false;\r\n            this.gameWin()\r\n        }\r\n    },\r\n\r\n    activeCombine() {\r\n        for (let i = 0; i < ROWS; i++) {\r\n            for (let j = 0; j < ROWS; j++) {\r\n                if (this._data[i][j] !== 0) {\r\n                    this._arrBlock[i][j].getComponent(\"BlockController\")._canCombine = true\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    checkGameOver() {\r\n        for (let i = 0; i < ROWS; i++) {\r\n            for (let j = 0; j < ROWS; j++) {\r\n                let n = this._data[i][j];\r\n                if (n === 0) return false;\r\n                if (j > 0 && this._data[i][j - 1] == n) return false;\r\n                if (j < ROWS - 1 && this._data[i][j + 1] == n) return false;\r\n                if (i > 0 && this._data[i - 1][j] == n) return false;\r\n                if (i < ROWS - 1 && this._data[i + 1][j] == n) return false;\r\n            }\r\n        }\r\n        return true;\r\n    },\r\n\r\n    blockMoveRight() {\r\n        let hasMoved = false;\r\n        this.activeCombine()\r\n        let move = (x, y, callback) => {\r\n            if (y == ROWS - 1 || this._data[x][y] == 0) {\r\n                callback && callback();\r\n                return;\r\n            } else if (this._data[x][y + 1] == 0) {\r\n                let block = this._arrBlock[x][y];\r\n                let position = this._posisions[x][y + 1];\r\n                this._arrBlock[x][y + 1] = block;\r\n                this._data[x][y + 1] = this._data[x][y];\r\n                this._data[x][y] = 0;\r\n                this._arrBlock[x][y] = null;\r\n                this.moveBlock(block, position, () => {\r\n                    move(x, y + 1, callback);\r\n                });\r\n                hasMoved = true;\r\n            } else if (this._data[x][y + 1] == this._data[x][y]) {\r\n                if (this._arrBlock[x][y + 1].getComponent(\"BlockController\")._canCombine) {\r\n                    let block = this._arrBlock[x][y];\r\n                    let position = this._posisions[x][y + 1];\r\n                    this._data[x][y + 1] *= 2;\r\n                    this._data[x][y] = 0;\r\n                    this._arrBlock[x][y] = null\r\n                    this.moveBlock(block, position, () => {\r\n                        this.combineBlock(block, this._arrBlock[x][y + 1], this._data[x][y + 1], () => {\r\n                            callback && callback();\r\n                        })\r\n                    });\r\n                    hasMoved = true;\r\n                }\r\n                else callback && callback()\r\n            } else {\r\n                callback && callback();\r\n                return;\r\n            }\r\n        }\r\n\r\n        let toMove = [];\r\n        for (let i = 0; i < ROWS; i++) {\r\n            for (let j = ROWS - 1; j >= 0; j--) {\r\n                if (this._data[i][j] != 0) {\r\n                    toMove.push({\r\n                        x: i,\r\n                        y: j,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        let count = 0;\r\n        for (let i = 0; i < toMove.length; i++) {\r\n            move(toMove[i].x, toMove[i].y, () => {\r\n                count++;\r\n                if (count == toMove.length) {\r\n                    this.afterMove(hasMoved);\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    blockMoveLeft() {\r\n        let hasMoved = false;\r\n        this.activeCombine()\r\n        let move = (x, y, callback) => {\r\n            if (y == 0 || this._data[x][y] == 0) {\r\n                callback && callback();\r\n                return;\r\n            } else if (this._data[x][y - 1] == 0) {\r\n                let block = this._arrBlock[x][y];\r\n                let position = this._posisions[x][y - 1];\r\n                this._arrBlock[x][y - 1] = block;\r\n                this._data[x][y - 1] = this._data[x][y];\r\n                this._data[x][y] = 0;\r\n                this._arrBlock[x][y] = null;\r\n                this.moveBlock(block, position, () => {\r\n                    move(x, y - 1, callback);\r\n                });\r\n                hasMoved = true;\r\n            } else if (this._data[x][y - 1] == this._data[x][y]) {\r\n                if (this._arrBlock[x][y - 1].getComponent(\"BlockController\")._canCombine) {\r\n                    let block = this._arrBlock[x][y];\r\n                    let position = this._posisions[x][y - 1];\r\n                    this._data[x][y - 1] *= 2;\r\n                    this._data[x][y] = 0;\r\n                    this._arrBlock[x][y] = null\r\n                    this.moveBlock(block, position, () => {\r\n                        this.combineBlock(block, this._arrBlock[x][y - 1], this._data[x][y - 1], () => {\r\n                            callback && callback();\r\n                        })\r\n                    });\r\n                    hasMoved = true;\r\n                }\r\n                else callback && callback()\r\n            } else {\r\n                callback && callback();\r\n                return;\r\n            }\r\n        }\r\n        let toMove = [];\r\n        for (let i = 0; i < ROWS; i++) {\r\n            for (let j = 0; j < ROWS; j++) {\r\n                if (this._data[i][j] != 0) {\r\n                    toMove.push({\r\n                        x: i,\r\n                        y: j,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        let count = 0;\r\n        for (let i = 0; i < toMove.length; i++) {\r\n            move(toMove[i].x, toMove[i].y, () => {\r\n                count++;\r\n                if (count == toMove.length) {\r\n                    this.afterMove(hasMoved);\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    blockMoveDown() {\r\n        let hasMoved = false;\r\n        this.activeCombine()\r\n        let move = (x, y, callback) => {\r\n            if (x == ROWS - 1 || this._data[x][y] == 0) {\r\n                callback && callback();\r\n                return;\r\n            } else if (this._data[x + 1][y] == 0) {\r\n                let block = this._arrBlock[x][y];\r\n                let position = this._posisions[x + 1][y];\r\n                this._arrBlock[x + 1][y] = block;\r\n                this._data[x + 1][y] = this._data[x][y];\r\n                this._data[x][y] = 0;\r\n                this._arrBlock[x][y] = null;\r\n                this.moveBlock(block, position, () => {\r\n                    move(x + 1, y, callback);\r\n                });\r\n                hasMoved = true;\r\n            } else if (this._data[x + 1][y] == this._data[x][y]) {\r\n                if (this._arrBlock[x + 1][y].getComponent(\"BlockController\")._canCombine) {\r\n                    let block = this._arrBlock[x][y];\r\n                    let position = this._posisions[x + 1][y];\r\n                    this._data[x + 1][y] *= 2;\r\n                    this._data[x][y] = 0;\r\n                    this._arrBlock[x][y] = null\r\n                    this.moveBlock(block, position, () => {\r\n                        this.combineBlock(block, this._arrBlock[x + 1][y], this._data[x + 1][y], () => {\r\n                            callback && callback();\r\n                        })\r\n                    });\r\n                    hasMoved = true;\r\n                }\r\n                else callback && callback()\r\n            } else {\r\n                callback && callback();\r\n                return;\r\n            }\r\n        }\r\n        let toMove = [];\r\n        for (let i = ROWS - 1; i >= 0; i--) {\r\n            for (let j = 0; j < ROWS; j++) {\r\n                if (this._data[i][j] != 0) {\r\n                    toMove.push({\r\n                        x: i,\r\n                        y: j,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        let count = 0;\r\n        for (let i = 0; i < toMove.length; i++) {\r\n            move(toMove[i].x, toMove[i].y, () => {\r\n                count++;\r\n                if (count == toMove.length) {\r\n                    this.afterMove(hasMoved);\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    blockMoveUp() {\r\n        let hasMoved = false;\r\n        this.activeCombine()\r\n        let move = (x, y, callback) => {\r\n            if (x == 0 || this._data[x][y] == 0) {\r\n                callback && callback();\r\n                return;\r\n            } else if (this._data[x - 1][y] == 0) {\r\n                let block = this._arrBlock[x][y];\r\n                let position = this._posisions[x - 1][y];\r\n                this._arrBlock[x - 1][y] = block;\r\n                this._data[x - 1][y] = this._data[x][y];\r\n                this._data[x][y] = 0;\r\n                this._arrBlock[x][y] = null;\r\n                this.moveBlock(block, position, () => {\r\n                    move(x - 1, y, callback);\r\n                });\r\n                hasMoved = true;\r\n            } else if (this._data[x - 1][y] == this._data[x][y]) {\r\n                if (this._arrBlock[x - 1][y].getComponent(\"BlockController\")._canCombine) {\r\n                    let block = this._arrBlock[x][y];\r\n                    let position = this._posisions[x - 1][y];\r\n                    this._data[x - 1][y] *= 2;\r\n                    this._data[x][y] = 0;\r\n                    this._arrBlock[x][y] = null\r\n                    this.moveBlock(block, position, () => {\r\n                        this.combineBlock(block, this._arrBlock[x - 1][y], this._data[x - 1][y], () => {\r\n                            callback && callback();\r\n                        })\r\n                    });\r\n                    hasMoved = true;\r\n                }\r\n                else callback && callback()\r\n            } else {\r\n                callback && callback();\r\n                return;\r\n            }\r\n        }\r\n        let toMove = [];\r\n        for (let i = 0; i < ROWS; i++) {\r\n            for (let j = 0; j < ROWS; j++) {\r\n                if (this._data[i][j] != 0) {\r\n                    toMove.push({\r\n                        x: i,\r\n                        y: j,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        let count = 0;\r\n        for (let i = 0; i < toMove.length; i++) {\r\n            move(toMove[i].x, toMove[i].y, () => {\r\n                count++;\r\n                if (count == toMove.length) {\r\n                    this.afterMove(hasMoved);\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    gameOver() {\r\n        cc.tween(this.node)\r\n            .to(.5, { opacity: 150 })\r\n            .start()\r\n        this.loseLayOut.active = true;\r\n        this.newGameBtn.getComponent(cc.Button).interactable = false;\r\n    },\r\n\r\n    gameWin() {\r\n        this._canMove = false;\r\n        cc.tween(this.node)\r\n            .to(.5, { opacity: 150 })\r\n            .start()\r\n        this.winLayOut.active = true;\r\n        this.newGameBtn.getComponent(cc.Button).interactable = false;\r\n    },\r\n\r\n    onRestartClick() {\r\n        for (let i = 0; i < this.bgBox.children.length; i++) {\r\n            if (this.bgBox.children[i] !== null) {\r\n                this.bgBox.children[i].destroy()\r\n            }\r\n        }\r\n        this._canMove = true;\r\n        this._canWin = true;\r\n        this.blockInit();\r\n        this.init();\r\n        this.node.opacity = 255;\r\n        this.loseLayOut.active = false\r\n        this.winLayOut.active = false\r\n        this.newGameBtn.getComponent(cc.Button).interactable = true;\r\n    },\r\n\r\n    onContinueClick() {\r\n        this._canMove = true;\r\n        this.node.opacity = 255;\r\n        this.winLayOut.active = false\r\n        this.newGameBtn.getComponent(cc.Button).interactable = true;\r\n    },\r\n\r\n    getScoreStorge() {\r\n        let scoreStorge = cc.sys.localStorage.getItem('bestScore');\r\n        if (scoreStorge !== null) {\r\n            this.bestScoreLabel.string = JSON.parse(scoreStorge);\r\n        } else {\r\n            this.bestScoreLabel.string = 0;\r\n        }\r\n    },\r\n\r\n    checkScore() {\r\n        let newScore = parseInt(this.scoreLabel.string);\r\n        if (newScore > this.bestScoreLabel.string) {\r\n            cc.sys.localStorage.setItem('bestScore', JSON.stringify(newScore));\r\n            this.bestScoreLabel.string = newScore;\r\n        }\r\n    },\r\n});"]}